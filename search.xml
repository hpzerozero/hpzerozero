<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[ä½¿ç”¨SafariæŸ¥çœ‹webviewå†…çš„ç½‘é¡µæºæ–‡ä»¶]]></title>
    <url>%2F2017%2F09%2F10%2FSafari%E6%9F%A5%E7%9C%8Bwebview%E6%BA%90%E7%A0%81%2F</url>
    <content type="text"><![CDATA[123 åœ¨å¾ˆå¤šæ—¶å€™åšJSå’ŒiOSè¿›è¡Œäº¤äº’çš„æ—¶å€™ï¼Œæƒ³è¦åŽ»è§‚å¯Ÿwebviewå†…çš„HTMLæºç ï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·æŸ¥çœ‹è¿è¡Œåœ¨ç½‘é¡µä¸Šçš„å†…å®¹ï¼Œè¿™æ—¶å€™å¼ºå¤§çš„Appleç»™äº†å¼€å‘è€…ä¸€ä¸ªåˆ©å™¨ï¼Œç®€å•è€Œåˆå¼ºå¤§ã€‚``` ä¸‹é¢æˆ‘ä»¬ä¸‹æ¨¡æ‹Ÿå™¨ä¸‹çš„æ•ˆæžœå›¾ï¼ˆçœŸæœºä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œéœ€è¦å¦åšå¤„ç†ï¼Œä¸‹é¢ä¼šä»‹ç»çš„ï¼‰ // æ­¤å¤„ä½¿ç”¨WKWebview,UIWebviewä¹Ÿæ˜¯ä¸€æ ·çš„ (void)viewDidLoad { [super viewDidLoad]; WKWebViewConfiguration * config = [[WKWebViewConfiguration alloc] init]; self.wkWebView = [[WKWebView alloc] initWithFrame:self.view.frame configuration:config]; NSURL *url = [NSURL URLWithString:@â€http://c.b1wt.com/h.SeL1Fn?cv=91mTtAqb8W&amp;sm=e6cf6eâ€œ]; [self.wkWebView loadRequest:[NSURLRequest requestWithURL:url]]; [self.view addSubview:self.wkWebView];}``` åšæ³•ï¼š xcodeä½¿ç”¨æ¨¡æ‹Ÿå™¨è¿è¡Œä»£ç ï¼Œè¿è¡Œèµ·æ¥åŽï¼Œæ‰“å¼€ç”µè„‘ä¸Šçš„Safariï¼Œæ‰¾åˆ°çª—å£é¡¶éƒ¨çš„å¼€å‘é€‰é¡¹ï¼Œå¦‚æžœæ‰¾ä¸åˆ°ï¼Œè¿›å…¥åå¥½è®¾ç½® å¦‚æžœæ­¤æ—¶æ¨¡æ‹Ÿå™¨å·²ç»è¿è¡Œåˆ°å«æœ‰webViewçš„éƒ¨åˆ†ï¼Œè¿™æ—¶å€™ç‚¹å¼€å¼€å‘è€…é€‰é¡¹å°±ä¼šçœ‹åˆ°Simulatorï¼Œè¿›å…¥å°±å¯ä»¥çœ‹åˆ°å½“å‰webviewå½“å‰æ­£åœ¨åŠ è½½çš„ç½‘å€ï¼Œé€‰ä¸€ä¸ªè¿›å…¥å°±ä¼šçœ‹åˆ°å¦‚ä¸‹éœ€è¦çš„ä¿¡æ¯ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾ˆè½»æ¾åœ°çœ‹åˆ°è¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ä¸Šçš„ç½‘é¡µå†…å®¹ï¼Œä¸ä»…å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æžœæµè§ˆå™¨æ”¯æŒå®žæ—¶ä¿®æ”¹HTMLçš„å†…å®¹å’ŒCSSæ ·å¼ï¼Œé‚£ä¹ˆåæ˜ åœ¨æ¨¡æ‹Ÿå™¨ä¸Šçš„ä¹Ÿä¼šåŒæ­¥ä¿®æ”¹ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿å•Š ä½†æ˜¯æœ‰äººè¯´æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œä¸åŽ‰å®³ï¼Œæ¯•ç«Ÿæ¨¡æ‹Ÿå™¨å’ŒSafariéƒ½æ˜¯åœ¨Macä¸Šè¿è¡Œçš„ï¼Œå¯ä»¥ç›‘æµ‹åˆ°webviewå†…å®¹å¾ˆå®¹æ˜“ï¼Œé‚£å¦‚æžœMacèƒ½ç›‘æµ‹çœŸæœºä¸Šçš„webviewè¿è¡Œæ˜¯ä¸æ˜¯å¾ˆå±Œï¼Œæˆ‘ä¸€è„¸å´‡æ‹œðŸ˜±ã€‚ å°†æ‰‹æœºé€šè¿‡æ•°æ®çº¿ä¸ŽMacç›¸è¿žï¼Œä½¿ç”¨xcodeé€‰æ‹©çœŸæœºè¿è¡Œä»£ç ï¼Œç„¶åŽåœ¨Safariå¼€å‘ä¸­é€‰æ‹©çœŸæœºçš„åå­—ï¼Œè€Œä¸æ˜¯simulator,å…¶ä½™è¿›è¡ŒåŒæ ·çš„æ“ä½œå°±å¯ä»¥å®žæ—¶æŸ¥çœ‹æ‰‹æœºä¸Šè¿è¡Œçš„ç½‘å€çš„æºç äº†ðŸ‘¯ðŸ‘¯ðŸ‘¯ðŸ‘¯ ã€‚ å¦‚æžœSafariä¸Šæ²¡æœ‰æ˜¾ç¤ºæ‰‹æœºçš„åç§°ï¼Œæ‰“å¼€æ‰‹æœºçš„è®¾ç½®ï¼Œåœ¨è®¾ç½®çš„é¦–é¡µæ‰¾åˆ°Safarié€‰é¡¹ï¼Œè¿›å…¥åŽï¼Œåœ¨æœ€ä¸‹é¢æœ‰ä¸ªé«˜çº§çš„é€‰é¡¹è¿›å…¥åŽï¼Œæ‰“å¼€Webæ£€æŸ¥å™¨ï¼Œç„¶åŽå†è¿è¡Œå°±ä¼šçœ‹åˆ°äº†ã€‚ ç¥å„ä½å¼€å‘è€…å·¥ä½œé¡ºåˆ©ï¼ŒçŽ©å¾—å¼€å¿ƒï¼ðŸ¤‘ðŸ¤‘ðŸ¤‘ðŸ¤‘ðŸ¤‘ðŸ¤‘ðŸ¤‘]]></content>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSè‡ªå®šä¹‰åˆ†äº«é¢æ¿å®žçŽ°åŽŸç”Ÿåˆ†äº«]]></title>
    <url>%2F2017%2F09%2F10%2FiOS%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E4%BA%AB%E9%9D%A2%E6%9D%BF%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%94%9F%E5%88%86%E4%BA%AB%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆéƒ½ä¸å¤šè¯´ï¼Œå…ˆçœ‹æ•ˆæžœå›¾ æ­¤å¤„ä¸ŽiOSåŽŸç”Ÿåˆ†äº«ä¸åŒçš„åœ°æ–¹æ˜¯ï¼Œè¿™ä¸ªå¼¹å‡ºçš„åˆ†äº«é¢æ¿æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œæƒ³è¦ä»€ä¹ˆæ ·å­ä»€ä¹ˆæ ·å­ï¼Œè€Œä¸”è¿˜å¯ä»¥æŒ‡å®šåˆ†äº«çš„å¹³å°ï¼Œå¦‚æžœéœ€è¦åˆ«çš„å¹³å°å¯ä»¥ç•™è¨€ç»™æˆ‘ï¼› ä»¥ä¸‹æ˜¯åŽŸç”Ÿçš„åˆ†äº«é¢æ¿ï¼Œè°ƒèµ·çš„åŽŸç”Ÿåˆ†äº« ä»¥ä¸‹æ˜¯å®žçŽ°çš„åŸºæœ¬æ€è·¯ï¼šè‡ªå®šä¹‰ä¸€ä¸ªviewController,ç„¶åŽä½¿ç”¨collectionViewè¿›è¡Œå¹³å°çš„å¸ƒå±€ 1234567891011121314151617181920212223242526272829#import &lt;UIKit/UIKit.h&gt;#import &quot;HPActivityCell.h&quot;#import &lt;Social/Social.h&gt;typedef void (^UIActivityViewControllerCompletionWithItemsHandler)(UIActivityType __nullable activityType, BOOL completed, NSArray * __nullable returnedItems, NSError * __nullable activityError);typedef void (^UIActivityViewControllerCompletionHandler)(UIActivityType __nullable activityType, BOOL completed);@protocol HPActivityViewControllerDelegate &lt;NSObject&gt;- (void)didSelectedItemsWithType:(UIActivityType _Nullable )type;@end@interface HPActivityViewController : UIViewController&lt;UICollectionViewDelegate,UICollectionViewDataSource&gt;- (instancetype _Nullable )initWithItems:(NSArray *_Nonnull)activityItems applicationActivities:(nullable NSArray *)applicationActivities;- (void)setItems:(NSArray *_Nullable)activityItems applicationActivities:(NSArray *_Nonnull)applicationActivities;@property(nullable, nonatomic, copy) UIActivityViewControllerCompletionHandler completionWithHandler; // set to nil after call@property(nullable, nonatomic, copy) NSArray&lt;UIActivityType&gt; *excludedActivityTypes; // default is nil. activity types listed will not be displayed- (void)reShare;/** The actual content of the action sheet */@property (strong, nonatomic) UIView * _Nonnull contentView;/** presentingViewController*/@property (weak, nonatomic) UIViewController * _Nullable presentingVC;@property (strong, nonatomic) NSArray * _Nullable activityItems;@property (weak, nonatomic ,nullable) id&lt;HPActivityViewControllerDelegate&gt; delegate;@end``` #import â€œHPActivityViewController.hâ€ #import â€œLFCollectionReusableView.hâ€ #import â€œMBProgressHUD.hâ€ #import â€œHeader.hâ€static NSString * const CellIdentifier = @â€HPActivityCellâ€; @interface HPActivityViewController ()@property (strong, nonatomic) UICollectionView collectionView;@property (strong, nonatomic) UICollectionViewFlowLayout collectionViewLayout;/* ///@property (strong, nonatomic) UIView lineView;@property (strong, nonatomic) UIButton cancelButton;@property (strong, nonatomic) UIToolbar *blurToolbar; @property (strong, nonatomic) NSArray applicationActivities;/** title/@property (strong, nonatomic) UILabel titleLabel;/** tips/@property (strong, nonatomic) UIButton *tipsButton; / action/@property (strong, nonatomic) NSMutableArray actionActivities;/ share/@property (strong, nonatomic) NSMutableArray shareActivities;/ èƒŒæ™¯å›¾/@property (strong, nonatomic) UIView bgView;/ webview/@property (weak, nonatomic) UIView webviewBgView; /* é€‰ä¸­çš„å¹³å°/@property (strong, nonatomic) NSIndexPath *indexPath;@end @implementation HPActivityViewController (void)setItems:(NSArray )activityItems applicationActivities:(NSArray )applicationActivities{ self.activityItems = activityItems; self.applicationActivities = applicationActivities; self.actionActivities = [NSMutableArray array]; self.shareActivities = [NSMutableArray array]; for (HPActivity * activity in applicationActivities) { if (activity.activityCategory == UIActivityCategoryShare) { [self.shareActivities addObject:activity]; }else if (activity.activityCategory == UIActivityCategoryAction) { [self.actionActivities addObject:activity]; } } [self.collectionView reloadData];} (instancetype)init{ self = [super init]; if (self) { // æ•´ä½“èƒŒæ™¯ self.bgView = [[UIView alloc] initWithFrame:self.view.frame]; self.bgView.backgroundColor = [UIColor blackColor]; self.bgView.alpha = 0.2; [self.view addSubview:self.bgView]; self.contentView = [[UIView alloc] init]; [self.view addSubview:self.contentView]; [self addBlurBackground]; [self setupTitleView]; [self setUpCollectionViewForPhone]; [self addCancelButton]; [self setBounds]; // æ·»åŠ æ‰‹åŠ¿ UITapGestureRecognizer * tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapAction:)]; tap.delegate = self; tap.numberOfTapsRequired = 1; tap.numberOfTouchesRequired = 1; [self.view addGestureRecognizer:tap]; } return self;} (instancetype)initWithItems:(NSArray )activityItems applicationActivities:(NSArray )applicationActivities{ self = [super init]; if (self) { self.activityItems = activityItems; self.applicationActivities = applicationActivities; self.actionActivities = [NSMutableArray array]; self.shareActivities = [NSMutableArray array]; for (HPActivity * activity in applicationActivities) { if (activity.activityCategory == UIActivityCategoryShare) { [self.shareActivities addObject:activity]; }else if (activity.activityCategory == UIActivityCategoryAction) { [self.actionActivities addObject:activity]; } } } return self;} (void)viewWillAppear:(BOOL)animated { [super viewWillAppear:animated]; [self setBounds];} (void)configureForPhone { CGFloat viewHeight = H(228); CGRect frame = CGRectMake(0,kScreenHeight - viewHeight,kScreenWidth,viewHeight); self.contentView.frame = frame; self.blurToolbar.frame = self.contentView.bounds; self.cancelButton.frame = CGRectMake(0, viewHeight-H(38), kScreenWidth, H(38)); CGRect collectionFrame = self.contentView.bounds; collectionFrame.origin.y = H(85); collectionFrame.size.height = (viewHeight-H(38)-H(86)); self.collectionView.frame = collectionFrame;} (void)setBounds { [self configureForPhone];}#pragma mark - (void)didTapCancelButton { [self removeView];}/* ç§»é™¤è§†å›¾/ (void)tapAction:(UITapGestureRecognizer *)gesture{ // ç‚¹å‡»çš„ä½ç½® CGPoint tapPoint = [gesture locationInView:self.view]; // ç‚¹å‡»èŒƒå›´ if (!CGRectContainsPoint(self.contentView.frame, tapPoint)) {[self removeView]; }}/* ç§»é™¤è§†å›¾/ (void)removeView{ // åŠ¨ç”» [UIView animateWithDuration:0.3 delay:0 options:UIViewAnimationOptionTransitionFlipFromRight animations:^{ self.contentView.transform = CGAffineTransformMakeTranslation(1.0, H(296)); self.bgView.alpha = 0.001; } completion:^(BOOL finished) { // ç§»é™¤æ‰‹åŠ¿ // [self.view removeGestureRecognizer:gesture]; // ç§»é™¤è§†å›¾ [self.view removeFromSuperview]; }];} // æ‰‹åŠ¿ä»£ç† (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer{ CGPoint tapPoint = [gestureRecognizer locationInView:self.view]; // ç‚¹å‡»èŒƒå›´ if (CGRectContainsPoint(self.contentView.frame, tapPoint)) {return NO; } return YES;}#pragma mark - UICollectionViewDataSource (NSInteger)numberOfSectionsInCollectionView:(UICollectionView *)collectionView { return 1;} (NSInteger)collectionView:(UICollectionView *)collectionView numberOfItemsInSection:(NSInteger)section { return self.applicationActivities.count;} (UICollectionViewCell )collectionView:(UICollectionView )collectionView cellForItemAtIndexPath:(NSIndexPath )indexPath { HPActivityCell cell = [self.collectionView dequeueReusableCellWithReuseIdentifier:CellIdentifier forIndexPath:indexPath];// if (indexPath.section==0) {// cell.activity = self.applicationActivities[indexPath.row]; // } else {// cell.activity = self.shareActivities[indexPath.row];// } return cell;} (UICollectionReusableView )collectionView:(UICollectionView )collectionView viewForSupplementaryElementOfKind:(NSString )kind atIndexPath:(NSIndexPath )indexPath{ LFCollectionReusableView footerView = [collectionView dequeueReusableSupplementaryViewOfKind:UICollectionElementKindSectionFooter withReuseIdentifier:@â€LFCollectionReusableViewâ€ forIndexPath:indexPath]; footerView.customView = [[UIView alloc] initWithFrame:CGRectMake(W(12), 0, footerView.frame.size.width-2W(12), 1)]; footerView.customView.backgroundColor = kRGB(204, 204, 204, 1); [footerView addSubview:footerView.customView]; return footerView;} #pragma mark - Rendering methods (void)addBlurBackground { // content èƒŒæ™¯ self.blurToolbar = [[UIToolbar alloc] initWithFrame:self.contentView.bounds]; self.blurToolbar.translucent = NO; [self.contentView insertSubview:self.blurToolbar atIndex:0];} (void)setupTitleView { self.titleLabel = [[UILabel alloc] initWithFrame:CGRectMake(0, H(23), kScreenWidth, H(12))]; self.titleLabel.textColor = kRGB(51, 51, 51, 1); self.titleLabel.text = @â€â€” åˆ†äº«æœ‰èµ â€”â€œ; self.titleLabel.textAlignment = NSTextAlignmentCenter; [self.contentView addSubview:self.titleLabel]; } (void)setUpCollectionViewForPhone { [self setUpCollectionView]; self.collectionViewLayout.itemSize = CGSizeMake(W(50), H(65)); self.collectionViewLayout.sectionInset = UIEdgeInsetsMake(H(20), W(20), H(17), 0); self.collectionView.scrollEnabled = NO; self.collectionViewLayout.minimumInteritemSpacing = 5; self.collectionViewLayout.minimumLineSpacing = 5; self.collectionViewLayout.footerReferenceSize = CGSizeMake(kScreenWidth, 1);} (void)setUpCollectionView { self.collectionViewLayout = [[UICollectionViewFlowLayout alloc] init]; self.collectionView = [[UICollectionView alloc] initWithFrame:CGRectZero collectionViewLayout:self.collectionViewLayout]; [self.collectionView registerClass:[HPActivityCell class] forCellWithReuseIdentifier:CellIdentifier]; [self.collectionView registerClass:[LFCollectionReusableView class] forSupplementaryViewOfKind:UICollectionElementKindSectionFooter withReuseIdentifier:@â€LFCollectionReusableViewâ€]; self.collectionView.dataSource = self; self.collectionView.delegate = self; [self.contentView addSubview: self.collectionView]; self.collectionView.backgroundColor = UIColor.clearColor;} (void)addCancelButton { // self.cancelButton = [UIButton buttonWithType:UIButtonTypeSystem]; self.cancelButton.frame = CGRectMake(0, 0, self.view.frame.size.width, H(38)); [self.cancelButton setTitle:@â€å–æ¶ˆâ€ forState:UIControlStateNormal]; [self.cancelButton setTitleColor:kRGB(51, 51, 51, 1) forState:UIControlStateNormal]; self.cancelButton.backgroundColor = UIColor.clearColor; [self.cancelButton addTarget:self action:@selector(didTapCancelButton) forControlEvents:UIControlEventTouchUpInside]; [self.contentView addSubview:self.cancelButton];} (void)dealloc{ NSLog(@â€%s,line=%d, é”€æ¯â€,FUNCTION,LINE);}123å…¶ä¸­è‡ªå®šä¹‰é¢æ¿çš„éƒ¨åˆ†éƒ½ä¸æ˜¯å¾ˆéš¾ï¼Œæ¯•ç«Ÿè¿™ä¹Ÿç®—åŸºæœ¬åŠŸäº†ï¼Œä½†æ˜¯æœ€ä¸»è¦æ˜¯é¢æ¿å®šä¹‰å¥½äº†å¦‚ä½•æ‰èƒ½ç‚¹å‡»å¹³å°è°ƒç”¨ç›¸å…³çš„å¹³å°è¿›è¡Œåˆ†äº«å‘¢ï¼Ÿ&lt;i class=&quot;fa fa-flag&quot;/&gt;**ä¸Šé¢çš„ä»£ç æ¯”è¾ƒä¹±ï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ€è·¯å†™ï¼Œæ ¸å¿ƒä»£ç å´æ˜¯ä¸‹é¢çš„éƒ¨åˆ†** #pragma mark - UICollectionViewDelegate (void)collectionView:(UICollectionView )collectionView didSelectItemAtIndexPath:(NSIndexPath )indexPath { self.indexPath = indexPath; HPActivity *activity = self.applicationActivities[indexPath.row]; if (self.activityItems) { [self alertSharePlatWithType:activity]; [self removeView]; } [self.collectionView deselectItemAtIndexPath:indexPath animated:YES];} (void)alertSharePlatWithType:(HPActivity )activity {UIImage imageToShare = nil;NSString * textToShare = nil; NSURL * urlToShare = nil; for (id obj in self.activityItems) { if ([obj isKindOfClass:[NSString class]]) { textToShare = obj; } if ([obj isKindOfClass:[UIImage class]]) { imageToShare = obj; } if ([obj isKindOfClass:[NSURL class]]) { urlToShare = obj; } } if ([activity.activityType isEqualToString:HPActivityTypeQQ]) { if ([SLComposeViewController isAvailableForServiceType:@&quot;com.tencent.mqq.ShareExtension&quot;]) { SLComposeViewController * composeVC = [SLComposeViewController composeViewControllerForServiceType:@&quot;com.tencent.mqq.ShareExtension&quot;]; composeVC.completionHandler = ^(SLComposeViewControllerResult result) { NSLog(@&quot;%s,line=%d&quot;,__FUNCTION__,__LINE__); }; if (urlToShare) { [composeVC addURL:urlToShare]; } [self.presentingVC presentViewController:composeVC animated:YES completion:nil]; } else { MBProgressHUD * hud = [MBProgressHUD showHUDAddedTo:self.presentingVC.view animated:YES]; hud.mode = MBProgressHUDModeText; hud.labelText = @&quot;æœªå®‰è£…QQ&quot;; [hud hide:YES afterDelay:1]; } } else if ([activity.activityType isEqualToString:HPActivityTypeWeChat]) { if ([SLComposeViewController isAvailableForServiceType:@&quot;com.tencent.xin.sharetimeline&quot;]) { SLComposeViewController * composeVC = [SLComposeViewController composeViewControllerForServiceType:@&quot;com.tencent.xin.sharetimeline&quot;]; composeVC.completionHandler = ^(SLComposeViewControllerResult result) { NSLog(@&quot;%s,line=%d&quot;,__FUNCTION__,__LINE__); }; if (urlToShare) { [composeVC addURL:urlToShare]; } [self.presentingVC presentViewController:composeVC animated:YES completion:nil]; } else { MBProgressHUD * hud = [MBProgressHUD showHUDAddedTo:self.presentingVC.view animated:YES]; hud.mode = MBProgressHUDModeText; hud.labelText = @&quot;æœªå®‰è£…å¾®ä¿¡&quot;; [hud hide:YES afterDelay:1]; } }else if ([activity.activityType isEqualToString:UIActivityTypeCopyToPasteboard]) { NSString * str = [NSString stringWithFormat:@&quot;ã€%@ã€‘ç‚¹å‡»é“¾æŽ¥ï¼Œé¢†å–ä¼˜æƒ åˆ¸ï¼Œè¿›å…¥ðŸ‘‰æ‰‹æœºæ·˜å®ðŸ‘ˆå³å¯çœ‹åˆ°ï¼Œ#LFopuoC#ï¼Œ%@&quot;,textToShare, urlToShare]; [UIPasteboard generalPasteboard].string = str; MBProgressHUD * hud = [MBProgressHUD showHUDAddedTo:self.presentingVC.view animated:YES]; hud.mode = MBProgressHUDModeText; hud.labelText = @&quot;å¤åˆ¶æˆåŠŸ,èµ¶å¿«åˆ†äº«ç»™å¥½å‹å§&quot;; [hud hide:YES afterDelay:1]; } else if ([activity.activityType isEqualToString:UIActivityTypePostToWeibo]) { if ([SLComposeViewController isAvailableForServiceType:@&quot;com.apple.social.sinaweibo&quot;]) { SLComposeViewController * composeVC = [SLComposeViewController composeViewControllerForServiceType:@&quot;com.apple.social.sinaweibo&quot;]; composeVC.completionHandler = ^(SLComposeViewControllerResult result) { NSLog(@&quot;%s,line=%d&quot;,__FUNCTION__,__LINE__); }; if(imageToShare) { if(![composeVC addImage:imageToShare]){ NSLog(@&quot;%s,line=%d,è®¾ç½®å¤±è´¥&quot;,__FUNCTION__,__LINE__); }; } if (textToShare) { if(![composeVC setInitialText:textToShare]){ NSLog(@&quot;%s,line=%d,è®¾ç½®å¤±è´¥&quot;,__FUNCTION__,__LINE__); }; } if (urlToShare) { if (![composeVC addURL:urlToShare]) { NSLog(@&quot;%s,line=%d,è®¾ç½®å¤±è´¥&quot;,__FUNCTION__,__LINE__); } } [self.presentingVC presentViewController:composeVC animated:YES completion:nil]; } else { MBProgressHUD * hud = [MBProgressHUD showHUDAddedTo:self.presentingVC.view animated:YES]; hud.mode = MBProgressHUDModeText; hud.labelText = @&quot;æœªå®‰è£…å¾®åš&quot;; [hud hide:YES afterDelay:1]; } } }123456æ€»ç»“ï¼šiOSé‡Œçš„åŽŸç”Ÿåˆ†äº«é¢æ¿æ˜¯ä½¿ç”¨`UIActivityViewController`è¿™ä¸ªç±»æ¥å®žçŽ°çš„ï¼Œæˆ‘åªæ˜¯ç…§ç€å®ƒçš„æ ·å­é‡å†™äº†ä¸€ä¸ªæˆ‘è‡ªå·±çš„ï¼Œè€Œ`UIActivityViewController`åœ¨ç‚¹å‡»å¹³å°çš„æ—¶å€™ä¹Ÿæ˜¯ä½¿ç”¨`SLComposeViewController`è¿™ä¸ªç±»æœ€ç»ˆå®žçŽ°,ä½†æ˜¯`SLComposeViewController`å¹¶æ²¡æœ‰å…¬å¼€é‡Œé¢çš„æœºåˆ¶ï¼Œä¸è¿‡æˆ‘çŒœæƒ³åº”è¯¥æ˜¯å°†`share Extension`å°è£…ä¸ºåŠç³»ç»Ÿçº§çš„ï¼Œæ‰€ä»¥ä¸ç®¡åœ¨å“ªä¸ªappçš„ç•Œé¢ï¼Œåªè¦è°ƒç”¨è¿™ä¸ªç±»éƒ½èƒ½åˆ†äº«ç»™å®žçŽ°äº†`share extension`åŠŸèƒ½çš„appï¼Œæ¯”å¦‚å¾®ä¿¡ã€QQã€å¾®åšã€Facebookç­‰ã€‚é¡ºä¾¿æä¸€ä¸‹ï¼Œç‚¹å‡»åˆ†äº«åŽçš„é‚£ä¸ªå¼¹çª—å¹¶ä¸æ˜¯ç³»ç»Ÿå†™çš„ï¼Œè€Œæ˜¯è¦åˆ†äº«çš„é‚£ä¸ªå¹³å°è‡ªå·±ä½¿ç”¨xcodeçš„`share extension`å¼€å‘çš„.##### SLComposeViewController #import #import typedef NS_ENUM(NSInteger, SLComposeViewControllerResult) { SLComposeViewControllerResultCancelled, SLComposeViewControllerResultDone}; typedef void (^SLComposeViewControllerCompletionHandler)(SLComposeViewControllerResult result); // Although you may perform requests on behalf of the user, you cannot append// text, images, or URLs without the userâ€™s knowledge. Hence, you can set the// initial text and other content before presenting the view to the user, but// cannot change the content after the user views it. All of the methods used// to set the content return a Boolean value. The methods return NO if the// content doesnâ€™t fit or if the view was already presented to the user and the// content can no longer be changed. SOCIAL_CLASS_AVAILABLE(NA, 6_0)@interface SLComposeViewController : UIViewController (BOOL)isAvailableForServiceType:(NSString *)serviceType; (SLComposeViewController )composeViewControllerForServiceType:(NSString )serviceType; @property(nonatomic, readonly) NSString *serviceType; // Sets the initial text to be posted. Returns NO if the sheet has already been// presented to the user. On iOS 6.x, this returns NO if the specified text// will not fit within the character space currently available; on iOS 7.0 and// later, you may supply text with a length greater than the service supports,// and the sheet will allow the user to edit it accordingly. (BOOL)setInitialText:(NSString *)text; // Adds an image to the post. Returns NO if the additional image will not fit// within the character space currently available, or if the sheet has already// been presented to the user. (BOOL)addImage:(UIImage *)image; // Removes all images from the post. Returns NO and does not perform an operation// if the sheet has already been presented to the user. (BOOL)removeAllImages; // Adds a URL to the post. Returns NO if the additional URL will not fit// within the character space currently available, or if the sheet has already// been presented to the user. (BOOL)addURL:(NSURL *)url; // Removes all URLs from the post. Returns NO and does not perform an operation// if the sheet has already been presented to the user. (BOOL)removeAllURLs; // Specify a block to be called when the user is finished. This block is not guaranteed// to be called on any particular thread. It is cleared after being called.@property (nonatomic, copy) SLComposeViewControllerCompletionHandler completionHandler;@end``` demoåœ°å€]]></content>
      <tags>
        <tag>iOS</tag>
      </tags>
  </entry>
</search>
